#!/usr/bin/env ruby

mongodb_uri = ENV['MONGODB_URI_PRODUCTION']

if mongodb_uri.to_s == ''
  raise "MONGODB_URI_PRODUCTION missing. Maybe you did not use 'dotenv mongo-backup'"
else
  puts "Backup will be taken from : #{mongodb_uri}"
end

if File.directory?('private/')
  dest = 'private/'
elsif File.directory?('.private/')
  dest = '.private/'
else
  Dir.mkdir 'private/'
  dest = 'private/'
end
puts "Backup will be saved in : #{dest}"

cmd = "mongodump --uri=#{mongodb_uri} --excludeCollection=system.users -o #{dest}"

puts 'Exec :'
puts cmd

system cmd

